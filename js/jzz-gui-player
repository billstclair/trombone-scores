/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/jzz-gui-player@1.3.7/javascript/JZZ.gui.Player.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i:"function"==typeof define&&define.amd?define("JZZ.gui.Player",["JZZ","JZZ.midi.SMF"],i):i(JZZ)}(0,function(t){if(t.gui||(t.gui={}),!t.gui.Player){var i={on:d,off:d,disable:d,title:d,div:{}};c.prototype.on=function(){this.div.style.backgroundColor="#ddd",this.div.style.borderColor="#ccc",this.div.firstChild.style.fill="#000"},c.prototype.off=function(){this.div.style.backgroundColor="#aaa",this.div.style.borderColor="#ccc",this.div.firstChild.style.fill="#000"},c.prototype.disable=function(){this.div.style.backgroundColor="#888",this.div.style.borderColor="#aaa",this.div.firstChild.style.fill="#555"},c.prototype.title=function(t){this.div.title=t};var e='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',o='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',s='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 6h12v12H6z"/></svg>',n='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>',l='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/></svg>',p='<svg fill="#555" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M10 4H2v16h20V6H12l-2-2z"/></svg>',r='<svg fill="#555" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/><path fill="none" d="M0 0h24v24H0z"/></svg>',a='<svg stroke="#ff8" xmlns="http://www.w3.org/2000/svg" width="7" height="7" viewBox="0 0 7 7"><line x1="1" y1="1" x2="6" y2="6"/><line x1="1" y1="6" x2="6" y2="1"/></svg>',h=0;y.prototype=new t.Widget,y.prototype.constructor=y,y.prototype.disable=function(){this.playBtn.disable(),this.pauseBtn.disable(),this.stopBtn.disable(),this.loopBtn.disable(),this.midiBtn.disable(),this.fileBtn.off(),this.rail.style.borderColor="#aaa",this.rail.style.backgroundColor="#888",this.caret.style.borderColor="#aaa",this.caret.style.backgroundColor="#888"},y.prototype.enable=function(){this.playBtn.off(),this.pauseBtn.off(),this.stopBtn.off(),this.loopBtn.off(),this._conn&&this.midiBtn.off(),this.rail.style.borderColor="#ccc",this.caret.style.backgroundColor="#aaa",this.caret.style.borderColor="#ccc"},y.prototype.load=function(t){var i=this;this._player=t.player(),this._player.trim(),this._player.connect(this),this._player.onEnd=function(){i._onEnd()},this.enable(),this.onLoad(t)},y.prototype.onEnd=function(){},y.prototype.onLoad=function(){},y.prototype._onEnd=function(){this.onEnd(),this._loop&&-1!=this._loop&&this._loop--,this._loop?1==this._loop?(this._loop=0,this.loopBtn.off(),this.loopBtn.title("loop")):this.loopBtn.title("loop: "+(-1==this._loop?"∞":this._loop)):(this._moving&&clearInterval(this._moving),this._move(),this._playing=!1,this.playBtn.off())},y.prototype._move=function(){var t=Math.round(this._player.positionMS()*this.rlen/this._player.durationMS())-5;this.caret.style.left=t+"px"},y.prototype.onPlay=function(){},y.prototype.onResume=function(){},y.prototype._resume=function(){var t=this;this._player.resume(),this._moving=setInterval(function(){t._move()},100)},y.prototype.play=function(){if(this._player){var i=this;if(this.playBtn.on(),this.pauseBtn.off(),this._playing)return;this._paused?this.onResume():this.onPlay(),this._playing=!0,this._paused=!1,this._out||!this._conn?this._resume():this._waiting||(this._waiting=!0,t().openMidiOut(i._ports).and(function(){i._out=this,i._outname=this.name(),i.midiBtn.title(i._outname),i._connect(this),i._waiting=!1,i._playing&&i._resume()}).or(function(){i._waiting=!1,i._resume()}))}},y.prototype.onStop=function(){},y.prototype.stop=function(){if(this._player){var i=this;this._player.stop(),t.lib.schedule(function(){i.onStop()}),this._moving&&clearInterval(this._moving),this._playing=!1,this._paused=!1,this.playBtn.off(),this.pauseBtn.off(),this._move()}},y.prototype.onPause=function(){},y.prototype.pause=function(i){this._player&&(this._paused?(void 0===i||i)&&(this._out?(this._resume(),this.onResume(),this._playing=!0,this._paused=!1,this.playBtn.on(),this.pauseBtn.off()):this.play()):this._playing&&(void 0!==i&&i||(this._player.pause(),t.lib.schedule(function(){self.onPause()}),this._moving&&clearInterval(this._moving),this._playing=!1,this._paused=!0,this.playBtn.off(),this.pauseBtn.on())))},y.prototype.loop=function(t){this._player&&(void 0===t&&(t=!this._loop),t==parseInt(t)&&t>0?this._loop=t:this._loop=t?-1:0,1==this._loop&&(this._loop=0),this._player.loop(this._loop),this._loop?(this.loopBtn.on(),this.loopBtn.title("loop: "+(-1==this._loop?"∞":this._loop))):(this.loopBtn.off(),this.loopBtn.title("loop")))},y.prototype.onClose=function(){},y.prototype.destroy=function(){if(this.stop(),this._out){var i=this._out;t.lib.schedule(function(){i.close()})}this.gui.parentNode.removeChild(this.gui),this.onClose()},y.prototype.setUrl=function(t,i){this.linkBtn&&(this._url&&(this.linkBtn.div.appendChild(this._url.firstChild),this.linkBtn.div.removeChild(this._url),this._url=void 0),void 0===t?this.linkBtn.disable():(this.linkBtn.off(),this._url=document.createElement("a"),this._url.target="_blank",this._url.appendChild(this.linkBtn.div.firstChild),this.linkBtn.div.appendChild(this._url),this._url.href=t,this._url.dataset||(this._url.dataset={}),this._url.dataset.jzzGuiPlayer=!0,void 0!==i&&(this._url.download=i)))},y.prototype.readFile=function(i){var e=this,o=new FileReader;o.onload=function(o){for(var s="",n=new Uint8Array(o.target.result),l=0;l<n.length;l++)s+=String.fromCharCode(n[l]);try{var p=new t.MIDI.SMF(s);e.stop(),t.lib.schedule(function(){e.load(p)}),e.linkBtn&&e.setUrl("data:audio/midi;base64,"+t.lib.toBase64(s),i.name)}catch(t){console.log(t.message)}},o.readAsArrayBuffer(i)},y.prototype.onSelect=function(){},y.prototype._closeselect=function(){this.midiBtn.off(),this.sel.style.display="none",this._more=!1},y.prototype.settings=function(){if(this._player&&!this._more&&this._conn){var i=this;this._more=!0,this.midiBtn.on(),this.sel.style.display="inline-block",t().refresh().and(function(){var t,e=this.info().outputs;for(t=0;t<i.sel.options.length;t++)i.sel.remove(t);for(t=0;t<e.length;t++)i.sel[t]=new Option(e[t].name,e[t].name,e[t].name==i._outname,e[t].name==i._outname);i.sel.size=e.length<2?2:e.length,i.sel.focus()})}},y.prototype._selectMidi=function(){var i=this;t().openMidiOut(this._newname).or(function(){i._newname=void 0,i._closeselect()}).and(function(){if(i._outname=i._newname,i._out){if(i._playing)for(var e=0;e<16;e++)i._out._receive(t.MIDI.allSoundOff(e));i._disconnect(i._out),i._out.close()}i._out=this,i._connect(this),i._newname=void 0,i._closeselect(),i.midiBtn.title(i._outname),setTimeout(function(){i.onSelect(i._outname)},0)})},y.prototype.select=function(t){var i=this;this._newname=t,this._newname==this._outname?(this._newname=void 0,this._closeselect()):setTimeout(function(){i._selectMidi()},0)},y.prototype._selected=function(){this.select(this.sel.options[this.sel.selectedIndex].value)},y.prototype._keydown=function(t){13!=t.keyCode&&32!=t.keyCode||this._selected()},y.prototype.type=function(){return this._player?this._player.type():0},y.prototype.tracks=function(){return this._player?this._player.tracks():0},y.prototype.duration=function(){return this._player?this._player.duration():0},y.prototype.durationMS=function(){return this._player?this._player.durationMS():0},y.prototype.position=function(){return this._player?this._player.position():0},y.prototype.positionMS=function(){return this._player?this._player.positionMS():0},y.prototype.tick2ms=function(){return this._player?this._player.tick2ms():0},y.prototype.ms2tick=function(){return this._player?this._player.ms2tick():0},y.prototype.onJump=function(){},y.prototype.jump=function(t){this._player&&(this._player.jump(t),this._move(),this._playing||(t?(this._paused=!0,this.playBtn.off(),this.pauseBtn.on()):(this._paused=!1,this.playBtn.off(),this.pauseBtn.off())),this.onJump(this._player.position()))},y.prototype.jumpMS=function(t){this._player&&(this._player.jumpMS(t),this._move(),this._playing||(t?(this._paused=!0,this.playBtn.off(),this.pauseBtn.on()):(this._paused=!1,this.playBtn.off(),this.pauseBtn.off())),this.onJump(this._player.position()))},y.prototype.speed=function(t){return this._player?this._player.speed(t):1},y.prototype._mousedown=function(t){f(t)&&this._player&&(this._more||t.preventDefault(),this.caret.style.backgroundColor="#ddd",this._wasPlaying=this._playing,this._player.pause(),this._caretX=t.clientX,this._caretPos=parseInt(this.caret.style.left)+5)},y.prototype._startmove=function(t){f(t)&&(this._more||t.preventDefault(),this._startX=parseInt(this.gui.style.left),this._startY=parseInt(this.gui.style.top),this._clickX=t.clientX,this._clickY=t.clientY)},y.prototype._mouseup=function(){this._player&&void 0!==this._caretX&&(this._wasPlaying&&(this._wasPlaying=void 0,this._player.resume()),this.caret.style.backgroundColor="#aaa",this._caretX=void 0),void 0!==this._startX&&(this._startX=void 0,this._startY=void 0,this._clickX=void 0,this._clickY=void 0)},y.prototype._mousemove=function(t){if(this._more&&(this._startX=void 0,this._startY=void 0,this._clickX=void 0,this._clickY=void 0),this._player&&void 0!==this._caretX){t.preventDefault();var i=this._caretPos+t.clientX-this._caretX;i<0&&(i=0),i>this.rlen&&(i=this.rlen),this.jumpMS(this.durationMS()*i*1/this.rlen)}else void 0!==this._startX&&(t.preventDefault(),this.gui.style.left=this._startX-this._clickX+t.clientX+"px",this.gui.style.top=this._startY-this._clickY+t.clientY+"px")},y.prototype._connect=y.prototype.connect,y.prototype._disconnect=y.prototype.disconnect,y.prototype.connect=function(t){t==this?(this._conn=!0,this._player&&this.midiBtn.off()):this._connect(t)},y.prototype.disconnect=function(t){t==this?(this._conn=!1,this._out&&this._disconnect(this._out),this._player&&this.midiBtn.disable()):this._disconnect(t)},t.gui.Player=y}function d(){}function c(t){this.div=document.createElement("div"),this.div.style.display="inline-block",this.div.style.position="absolute",this.div.style.boxSizing="content-box",this.div.style.top="8px",this.div.style.margin="0",this.div.style.padding="2px",this.div.style.borderStyle="solid",this.div.style.borderWidth="1px",this.div.style.borderColor="#aaa",this.div.style.backgroundColor="#888",this.div.style.lineHeight="0",this.div.style.lineSpasing="0",this.div.style.width="18px",this.div.style.height="18px",this.div.innerHTML=t}function u(t){t.stopPropagation(),t.preventDefault()}function y(t,d){if(!(this instanceof y))return new y(t,d);var f={at:void 0,x:void 0,y:void 0,play:!0,record:!1,pause:!0,stop:!0,loop:!0,file:!1,link:!1,midi:!0,close:!1,ports:[void 0,/MIDI Through/i],connect:!0};if("object"==typeof t)for(var _ in f)f.hasOwnProperty(_)&&void 0!==t[_]&&(f[_]=t[_]);if(void 0===f.at&&(f.at=t),void 0===f.x&&(f.x=t),void 0===f.y&&(f.y=d),function(t,h){t.gui=document.createElement("div"),t.gui.style.display="inline-block",t.gui.style.position="relative",t.gui.style.boxSizing="content-box",t.gui.style.margin="0px",t.gui.style.padding="0px",t.gui.style.borderStyle="none",t.gui.style.backgroundColor="#888",t.gui.style.width="270px",t.gui.style.height="40px";var d=8,y=238;h.play?(t.playBtn=new c(e),t.playBtn.div.style.left=d+"px",d+=28,t.playBtn.div.title="play",t.playBtn.div.addEventListener("click",function(){t.play()}),t.gui.appendChild(t.playBtn.div)):t.playBtn=i,h.pause?(t.pauseBtn=new c(o),t.pauseBtn.div.style.left=d+"px",d+=28,t.pauseBtn.div.title="pause",t.pauseBtn.div.addEventListener("click",function(){t.pause()}),t.gui.appendChild(t.pauseBtn.div)):t.pauseBtn=i,h.stop?(t.stopBtn=new c(s),t.stopBtn.div.style.left=d+"px",d+=28,t.stopBtn.div.title="stop",t.stopBtn.div.addEventListener("click",function(){t.stop()}),t.gui.appendChild(t.stopBtn.div)):t.stopBtn=i,h.loop?(t.loopBtn=new c(n),t.loopBtn.div.style.left=d+"px",d+=28,t.loopBtn.div.title="loop",t.loopBtn.div.addEventListener("click",function(){t.loop()}),t.gui.appendChild(t.loopBtn.div)):t.loopBtn=i,h.midi?(t.midiBtn=new c(l),t.midiBtn.div.style.left=y+"px",y-=28,t.midiBtn.div.title="midi",t.midiBtn.div.addEventListener("click",function(){t.settings()}),t.gui.appendChild(t.midiBtn.div),t.sel=document.createElement("select"),t.sel.style.position="absolute",t.sel.style.top="30px",t.sel.style.left="40px",t.sel.style.width="230px",t.sel.style.display="none",t.sel.style.zIndex=1,t.sel.addEventListener("click",function(){t._selected()}),t.sel.addEventListener("keydown",function(i){t._keydown(i)}),t.sel.addEventListener("focusout",function(){t._closeselect()}),t.gui.appendChild(t.sel)):t.midiBtn=i,h.link&&(t.linkBtn=new c(r),t.linkBtn.div.style.left=y+"px",y-=28,t.linkBtn.div.title="link",t.gui.appendChild(t.linkBtn.div)),h.file?(t.fileBtn=new c(p),t.fileBtn.div.style.left=y+"px",y-=28,t.fileBtn.div.title="file",t.gui.appendChild(t.fileBtn.div),t.fileInput=document.createElement("input"),t.fileInput.type="file",t.fileInput.style.position="fixed",t.fileInput.style.top="-1000px",t.fileInput.accept=".mid, .midi, .kar, .rmi",t.gui.appendChild(t.fileInput),window.FileReader&&(t.fileBtn.off(),t.fileBtn.div.addEventListener("click",function(){t.fileInput.click()}),t.fileInput.addEventListener("change",function(i){u(i),i.target.files[0]&&t.readFile(i.target.files[0])}),t.gui.addEventListener("drop",function(i){u(i),t.fileBtn.off(),t.readFile(i.dataTransfer.files[0])}),t.gui.addEventListener("dragover",function(i){u(i),t.fileBtn.on(),i.dataTransfer.dropEffect="copy"}),t.gui.addEventListener("dragexit",function(i){u(i),t.fileBtn.off()}))):t.fileBtn=i,h.close&&(t.closeBtn=document.createElement("div"),t.closeBtn.style.display="inline-block",t.closeBtn.style.position="absolute",t.closeBtn.style.boxSizing="content-box",t.closeBtn.style.top="1px",t.closeBtn.style.left="262px",t.closeBtn.style.margin="0",t.closeBtn.style.padding="0",t.closeBtn.style.backgroundColor="#f44",t.closeBtn.style.width="7px",t.closeBtn.style.height="7px",t.closeBtn.style.lineHeight="0",t.closeBtn.style.lineSpasing="0",t.closeBtn.innerHTML=a,t.closeBtn.title="close",t.closeBtn.addEventListener("click",function(){t.destroy()}),t.gui.appendChild(t.closeBtn)),t.rlen=y-d+10,t.rail=document.createElement("div"),t.rail.style.display="inline-block",t.rail.style.position="absolute",t.rail.style.boxSizing="content-box",t.rail.style.top="19px",t.rail.style.left=d+5+"px",t.rail.style.width=t.rlen+"px",t.rail.style.height="0",t.rail.style.padding="1px",t.rail.style.borderStyle="solid",t.rail.style.borderWidth="1px",t.rail.style.borderRadius="2px",t.rail.style.borderColor="#aaa",t.rail.style.backgroundColor="#888",t.gui.appendChild(t.rail),t.caret=document.createElement("div"),t.caret.style.display="inline-block",t.caret.style.position="absolute",t.caret.style.boxSizing="content-box",t.caret.style.width="2px",t.caret.style.height="2px",t.caret.style.top="-5px",t.caret.style.left="-5px",t.caret.style.padding="4px",t.caret.style.borderStyle="solid",t.caret.style.borderWidth="1px",t.caret.style.borderRadius="6px",t.caret.style.borderColor="#aaa",t.caret.style.backgroundColor="#888",t.caret.addEventListener("mousedown",function(i){t._mousedown(i)}),t.rail.appendChild(t.caret),window.addEventListener("mousemove",function(i){t._mousemove(i)}),window.addEventListener("mouseup",function(i){t._mouseup(i)})}(this,f),f.ports instanceof Array||(f.ports=[f.ports]),f.ports.push(void 0),this._ports=f.ports,this._conn=f.connect,"string"==typeof f.at)try{return document.getElementById(f.at).appendChild(this.gui),this}catch(t){}try{return f.at.appendChild(this.gui),this}catch(t){}f.x==parseInt(f.x)&&f.y==parseInt(f.y)||(f.x=15*h+5,f.y=45*h+5,h++),this.gui.style.position="fixed",this.gui.style.top=f.y+"px",this.gui.style.left=f.x+"px",this.gui.style.opacity=.9;var v=this;this.gui.addEventListener("mousedown",function(t){v._startmove(t)}),document.body.appendChild(this.gui)}function f(t){return void 0===t.buttons?!t.button:1&t.buttons}});
//# sourceMappingURL=/sm/8b0ca552a48d14b18a223b90ae5cea9fef7fff491074e5fef45fcc8ed70cb3f9.map